import{T as rt,H as Ne}from"./ThemeToggle-RwFCHz_5.js";import{k as se,c as N,i as y,a as p,n as ce,l as F,p as D,q as Ye,b as s,r as C,o as qe,s as it,v as Ee,d as A,e as z,w as i,T as ut,x as Ce,y as $,z as he,A as je,B as Se,C as me,D as $e,j as _,t as W,E as Fe,G as ct,H as dt,F as Xe,I as ft,J as mt,K as pt,L as vt,u as T,g as gt,M as We,f as yt,N as I,O as V}from"./index-DeoopqlN.js";import{_ as kt}from"./xiaoyugan-Dwisk7G8.js";import bt from"./manual-DKuNWELT.js";import wt from"./url-cj2e2lJ1.js";import{K as Tt,E as Ct,B as ht,T as St}from"./bin-7EUq5wrI.js";import{_ as $t}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Ze,g as ve,i as pe,s as Le,a as De,b as _t,c as Bt,o as de,d as xe,I as Ot,e as Mt,f as Ut,h as At,j as Et,B as Je,C as xt,u as zt,k as Lt,l as Dt,m as Pt,n as le,p as Re,q as Ve,r as It,t as Nt,v as _e,w as jt,x as Ft,y as He}from"./index-BxpJKcdT.js";import{M as Wt}from"./index-CdlkIgWE.js";import{C as Rt,S as Vt,T as Ht,a as Gt}from"./index-C3qvSZk1.js";import{A as Ge}from"./Add-rO22aRC8.js";import{M as Kt}from"./Menu-BPLaAFEw.js";import{R as Ke}from"./Refresh-CrwpMcHx.js";import{E as Yt}from"./EllipsisHorizontal-CZnQXpNz.js";import{C as qt}from"./Copy-DOVdzkHS.js";import"./AlertCircleOutline-Cz5sQCmi.js";import"./CloudUpload-Ch-FQCif.js";import"./render-function-Db3_BGqF.js";const Xt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Zt=p("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),Jt=[Zt],Qt=se({name:"Star",render:function(o,a){return y(),N("svg",Xt,Jt)}}),en=se({name:"IconInfoCircleFill",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:o}){const a=ve("icon"),r=D(()=>[a,`${a}-info-circle-fill`,{[`${a}-spin`]:e.spin}]),k=D(()=>{const u={};return e.size&&(u.fontSize=pe(e.size)?`${e.size}px`:e.size),e.rotate&&(u.transform=`rotate(${e.rotate}deg)`),u});return{cls:r,innerStyle:k,onClick:u=>{o("click",u)}}}}),tn=["stroke-width","stroke-linecap","stroke-linejoin"];function nn(e,o,a,r,k,l){return y(),N("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:F(e.cls),style:ce(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:o[0]||(o[0]=(...u)=>e.onClick&&e.onClick(...u))},o[1]||(o[1]=[p("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1)]),14,tn)}var Be=Ze(en,[["render",nn]]);const on=Object.assign(Be,{install:(e,o)=>{var a;const r=(a=o==null?void 0:o.iconPrefix)!=null?a:"";e.component(r+Be.name,Be)}}),ln=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],sn=["normal","processing","success","warning","danger"];var Oe=se({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:e=>sn.includes(e)},count:{type:Number}},setup(e,{slots:o}){const{status:a,color:r,dotStyle:k,offset:l,text:u,dot:v,maxCount:g,count:d}=Ye(e),f=ve("badge"),b=an(f,a==null?void 0:a.value,o==null?void 0:o.default),O=D(()=>{const c={...(k==null?void 0:k.value)||{}},[h,M]=(l==null?void 0:l.value)||[];h&&(c.marginRight=`${-h}px`),M&&(c.marginTop=`${M}px`);const E=!(r!=null&&r.value)||ln.includes(r==null?void 0:r.value)?{}:{backgroundColor:r.value};return{mergedStyle:{...E,...c},computedDotStyle:c,computedColorStyle:E}}),U=()=>{const c=u==null?void 0:u.value,h=r==null?void 0:r.value,M=a==null?void 0:a.value,E=v==null?void 0:v.value,B=Number(d==null?void 0:d.value),K=(d==null?void 0:d.value)!=null,{computedDotStyle:H,mergedStyle:L}=O.value;return o.content?s("span",{class:`${f}-custom-dot`,style:H},[o.content()]):c&&!h&&!M?s("span",{class:`${f}-text`,style:H},[c]):M||h&&!K?s("span",{class:`${f}-status-wrapper`},[s("span",{class:[`${f}-status-dot`,{[`${f}-status-${M}`]:M,[`${f}-color-${h}`]:h}],style:L},null),c&&s("span",{class:`${f}-status-text`},[c])]):(E||h)&&B>0?s("span",{class:[`${f}-dot`,{[`${f}-color-${h}`]:h}],style:L},null):B===0?null:s("span",{class:`${f}-number`,style:L},[s("span",null,[g.value&&B>g.value?`${g.value}+`:B])])};return()=>s("span",{class:b.value},[o.default&&o.default(),U()])}});const an=(e,o,a)=>D(()=>[e,{[`${e}-status`]:o,[`${e}-no-children`]:!a}]),rn=Object.assign(Oe,{install:(e,o)=>{Le(e,o);const a=De(o);e.component(a+Oe.name,Oe)}}),un=e=>{const o=C(!1),a={overflow:"",width:"",boxSizing:""};return{setOverflowHidden:()=>{if(e.value){const l=e.value;if(!o.value&&l.style.overflow!=="hidden"){const u=_t(l);(u>0||Bt(l))&&(a.overflow=l.style.overflow,a.width=l.style.width,a.boxSizing=l.style.boxSizing,l.style.overflow="hidden",l.style.width=`${l.offsetWidth-u}px`,l.style.boxSizing="border-box",o.value=!0)}}},resetOverflow:()=>{if(e.value&&o.value){const l=e.value;l.style.overflow=a.overflow,l.style.width=a.width,l.style.boxSizing=a.boxSizing,o.value=!1}}}},cn=({modalRef:e,wrapperRef:o,draggable:a,alignCenter:r})=>{const k=C(!1),l=C([0,0]),u=C([0,0]),v=C(),g=C([0,0]),d=C([0,0]),f=()=>{var c,h,M;if(o.value&&e.value){const{top:E,left:B}=o.value.getBoundingClientRect(),{clientWidth:K,clientHeight:H}=o.value,{top:L,left:Z,width:Y,height:q}=e.value.getBoundingClientRect(),R=r.value?0:(c=e.value)==null?void 0:c.offsetTop,j=Z-B,J=L-E-R;(j!==((h=u.value)==null?void 0:h[0])||J!==((M=u.value)==null?void 0:M[1]))&&(u.value=[j,J]);const X=K>Y?K-Y:0,Q=H>q?H-q-R:0;(X!==d.value[0]||Q!==d.value[1])&&(d.value=[X,Q]),R&&(g.value=[0,0-R])}},b=c=>{a.value&&(c.preventDefault(),k.value=!0,f(),l.value=[c.x,c.y],de(window,"mousemove",O),de(window,"mouseup",U),de(window,"contextmenu",U))},O=c=>{if(k.value){const h=c.x-l.value[0],M=c.y-l.value[1];let E=u.value[0]+h,B=u.value[1]+M;E<g.value[0]&&(E=g.value[0]),E>d.value[0]&&(E=d.value[0]),B<g.value[1]&&(B=g.value[1]),B>d.value[1]&&(B=d.value[1]),v.value=[E,B]}},U=()=>{k.value=!1,xe(window,"mousemove",O),xe(window,"mouseup",U)};return{position:v,handleMoveDown:b}};var dn=se({name:"Modal",components:{ClientOnly:xt,ArcoButton:Je,IconHover:Et,IconClose:At,IconInfoCircleFill:on,IconCheckCircleFill:Ut,IconExclamationCircleFill:Mt,IconCloseCircleFill:Ot},inheritAttrs:!1,props:{visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"center"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:e=>e.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:e=>e.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:e=>e.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String},hideTitle:{type:Boolean,default:!1}},emits:{"update:visible":e=>!0,ok:e=>!0,cancel:e=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0},setup(e,{emit:o}){const{fullscreen:a,popupContainer:r,alignCenter:k}=Ye(e),l=ve("modal"),{t:u}=zt(),v=C(),g=C(),d=C(e.defaultVisible),f=D(()=>{var t;return(t=e.visible)!=null?t:d.value}),b=C(!1),O=D(()=>e.okLoading||b.value),U=D(()=>e.draggable&&!e.fullscreen),{teleportContainer:c,containerRef:h}=Lt({popupContainer:r,visible:f}),M=C(f.value),E=D(()=>e.okText||u("modal.okText")),B=D(()=>e.cancelText||u("modal.cancelText")),{zIndex:K,isLastDialog:H}=Dt("dialog",{visible:f});let L=!1;const Z=t=>{e.escToClose&&t.key===Tt.ESC&&H()&&ee(t)},Y=()=>{e.escToClose&&!L&&(L=!0,de(document.documentElement,"keydown",Z))},q=()=>{L=!1,xe(document.documentElement,"keydown",Z)};let R=0;const{position:j,handleMoveDown:J}=cn({wrapperRef:v,modalRef:g,draggable:U,alignCenter:k}),X=()=>{R++,b.value&&(b.value=!1),d.value=!1,o("update:visible",!1)},Q=async t=>{const n=R,w=await new Promise(async S=>{var G;if(le(e.onBeforeOk)){let P=e.onBeforeOk((x=!0)=>S(x));if((Re(P)||!Ve(P))&&(b.value=!0),Re(P))try{P=(G=await P)!=null?G:!0}catch(x){throw P=!1,x}Ve(P)&&S(P)}else S(!0)});n===R&&(w?(o("ok",t),X()):b.value&&(b.value=!1))},ee=t=>{var n;let w=!0;le(e.onBeforeCancel)&&(w=(n=e.onBeforeCancel())!=null?n:!1),w&&(o("cancel",t),X())},te=C(!1),ge=t=>{t.target===v.value&&(te.value=!0)},ye=t=>{e.mask&&e.maskClosable&&te.value&&ee(t)},ke=()=>{f.value&&(!It(v.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),o("open"))},be=()=>{f.value||(U.value&&(j.value=void 0),M.value=!1,ne(),o("close"))},{setOverflowHidden:ae,resetOverflow:ne}=un(h);qe(()=>{h.value=Pt(e.popupContainer),f.value&&(ae(),e.escToClose&&Y())}),it(()=>{ne(),q()}),Ee(f,t=>{d.value!==t&&(d.value=t),t?(o("beforeOpen"),M.value=!0,te.value=!1,ae(),Y()):(o("beforeClose"),q())}),Ee(a,()=>{j.value&&(j.value=void 0)});const we=D(()=>[`${l}-wrapper`,{[`${l}-wrapper-align-center`]:e.alignCenter&&!e.fullscreen,[`${l}-wrapper-moved`]:!!j.value}]),Te=D(()=>[`${l}`,e.modalClass,{[`${l}-simple`]:e.simple,[`${l}-draggable`]:U.value,[`${l}-fullscreen`]:e.fullscreen}]),re=D(()=>{var t;const n={...(t=e.modalStyle)!=null?t:{}};return e.width&&!e.fullscreen&&(n.width=pe(e.width)?`${e.width}px`:e.width),!e.alignCenter&&e.top&&(n.top=pe(e.top)?`${e.top}px`:e.top),j.value&&(n.transform=`translate(${j.value[0]}px, ${j.value[1]}px)`),n});return{prefixCls:l,mounted:M,computedVisible:f,containerRef:h,wrapperRef:v,mergedModalStyle:re,okDisplayText:E,cancelDisplayText:B,zIndex:K,handleOk:Q,handleCancel:ee,handleMaskClick:ye,handleMaskMouseDown:ge,handleOpen:ke,handleClose:be,mergedOkLoading:O,modalRef:g,wrapperCls:we,modalCls:Te,teleportContainer:c,handleMoveDown:J}}});function fn(e,o,a,r,k,l){const u=A("icon-info-circle-fill"),v=A("icon-check-circle-fill"),g=A("icon-exclamation-circle-fill"),d=A("icon-close-circle-fill"),f=A("icon-close"),b=A("icon-hover"),O=A("arco-button"),U=A("client-only");return y(),z(U,null,{default:i(()=>[(y(),z(ut,{to:e.teleportContainer,disabled:!e.renderToBody},[!e.unmountOnClose||e.computedVisible||e.mounted?Ce((y(),N("div",he({key:0,class:`${e.prefixCls}-container`,style:{zIndex:e.zIndex}},e.$attrs),[s(je,{name:e.maskAnimationName,appear:""},{default:i(()=>[e.mask?Ce((y(),N("div",{key:0,ref:"maskRef",class:F(`${e.prefixCls}-mask`),style:ce(e.maskStyle)},null,6)),[[Se,e.computedVisible]]):$("v-if",!0)]),_:1},8,["name"]),p("div",{ref:"wrapperRef",class:F(e.wrapperCls),onClick:o[2]||(o[2]=me((...c)=>e.handleMaskClick&&e.handleMaskClick(...c),["self"])),onMousedown:o[3]||(o[3]=me((...c)=>e.handleMaskMouseDown&&e.handleMaskMouseDown(...c),["self"]))},[s(je,{name:e.modalAnimationName,appear:"",onAfterEnter:e.handleOpen,onAfterLeave:e.handleClose,persisted:""},{default:i(()=>[Ce(p("div",{ref:"modalRef",class:F(e.modalCls),style:ce(e.mergedModalStyle)},[!e.hideTitle&&(e.$slots.title||e.title||e.closable)?(y(),N("div",{key:0,class:F(`${e.prefixCls}-header`),onMousedown:o[1]||(o[1]=(...c)=>e.handleMoveDown&&e.handleMoveDown(...c))},[e.$slots.title||e.title?(y(),N("div",{key:0,class:F([`${e.prefixCls}-title`,`${e.prefixCls}-title-align-${e.titleAlign}`])},[e.messageType?(y(),N("div",{key:0,class:F(`${e.prefixCls}-title-icon`)},[e.messageType==="info"?(y(),z(u,{key:0})):$("v-if",!0),e.messageType==="success"?(y(),z(v,{key:1})):$("v-if",!0),e.messageType==="warning"?(y(),z(g,{key:2})):$("v-if",!0),e.messageType==="error"?(y(),z(d,{key:3})):$("v-if",!0)],2)):$("v-if",!0),$e(e.$slots,"title",{},()=>[_(W(e.title),1)])],2)):$("v-if",!0),!e.simple&&e.closable?(y(),N("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:F(`${e.prefixCls}-close-btn`),onClick:o[0]||(o[0]=(...c)=>e.handleCancel&&e.handleCancel(...c))},[s(b,null,{default:i(()=>[s(f)]),_:1})],2)):$("v-if",!0)],34)):$("v-if",!0),p("div",{class:F([`${e.prefixCls}-body`,e.bodyClass]),style:ce(e.bodyStyle)},[$e(e.$slots,"default")],6),e.footer?(y(),N("div",{key:1,class:F(`${e.prefixCls}-footer`)},[$e(e.$slots,"footer",{},()=>[e.hideCancel?$("v-if",!0):(y(),z(O,he({key:0},e.cancelButtonProps,{onClick:e.handleCancel}),{default:i(()=>[_(W(e.cancelDisplayText),1)]),_:1},16,["onClick"])),s(O,he({type:"primary"},e.okButtonProps,{loading:e.mergedOkLoading,onClick:e.handleOk}),{default:i(()=>[_(W(e.okDisplayText),1)]),_:1},16,["loading","onClick"])])],2)):$("v-if",!0)],6),[[Se,e.computedVisible]])]),_:3},8,["name","onAfterEnter","onAfterLeave"])],34)],16)),[[Se,e.computedVisible||e.mounted]]):$("v-if",!0)],8,["to","disabled"]))]),_:3})}var fe=Ze(dn,[["render",fn]]);const Me=(e,o)=>{let a=Nt("modal");const r=()=>{d.component&&(d.component.props.visible=!1),le(e.onOk)&&e.onOk()},k=()=>{d.component&&(d.component.props.visible=!1),le(e.onCancel)&&e.onCancel()},l=async()=>{await ct(),a&&(Fe(null,a),document.body.removeChild(a)),a=null,le(e.onClose)&&e.onClose()},u=()=>{d.component&&(d.component.props.visible=!1)},v=f=>{d.component&&Object.entries(f).forEach(([b,O])=>{d.component.props[b]=O})},d=s(fe,{...{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:r,onCancel:k,onClose:l},...jt(e,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof e.footer=="boolean"?e.footer:void 0},{default:_e(e.content),title:_e(e.title),footer:typeof e.footer!="boolean"?_e(e.footer):void 0});return(o??ze._context)&&(d.appContext=o??ze._context),Fe(d,a),document.body.appendChild(a),{close:u,update:v}},Ue={open:Me,confirm:(e,o)=>{const a={simple:!0,messageType:"warning",...e};return Me(a,o)},...Wt.reduce((e,o)=>(e[o]=(a,r)=>{const k={simple:!0,hideCancel:!0,messageType:o,...a};return Me(k,r)},e),{})},ze=Object.assign(fe,{...Ue,install:(e,o)=>{Le(e,o);const a=De(o);e.component(a+fe.name,fe);const r={};for(const k of Object.keys(Ue))r[k]=(l,u=e._context)=>Ue[k](l,u);e.config.globalProperties.$modal=r},_context:null});var Ae=se({name:"Space",props:{align:{type:String},direction:{type:String,default:"horizontal"},size:{type:[Number,String,Array],default:"small"},wrap:{type:Boolean},fill:{type:Boolean}},setup(e,{slots:o}){const a=ve("space"),r=D(()=>{var v;return(v=e.align)!=null?v:e.direction==="horizontal"?"center":""}),k=D(()=>[a,{[`${a}-${e.direction}`]:e.direction,[`${a}-align-${r.value}`]:r.value,[`${a}-wrap`]:e.wrap,[`${a}-fill`]:e.fill}]);function l(v){if(pe(v))return v;switch(v){case"mini":return 4;case"small":return 8;case"medium":return 16;case"large":return 24;default:return 8}}const u=v=>{const g={},d=`${l(He(e.size)?e.size[0]:e.size)}px`,f=`${l(He(e.size)?e.size[1]:e.size)}px`;return v?e.wrap?{marginBottom:f}:{}:(e.direction==="horizontal"&&(g.marginRight=d),(e.direction==="vertical"||e.wrap)&&(g.marginBottom=f),g)};return()=>{var v;const g=Ft((v=o.default)==null?void 0:v.call(o),!0).filter(d=>d.type!==dt);return s("div",{class:k.value},[g.map((d,f)=>{var b,O;const U=o.split&&f>0;return s(Xe,{key:(b=d.key)!=null?b:`item-${f}`},[U&&s("div",{class:`${a}-item-split`,style:u(!1)},[(O=o.split)==null?void 0:O.call(o)]),s("div",{class:`${a}-item`,style:u(f===g.length-1)},[d])])})])}}});const mn=Object.assign(Ae,{install:(e,o)=>{Le(e,o);const a=De(o);e.component(a+Ae.name,Ae)}}),pn={class:"token-import-page"},vn={class:"container"},gn={class:"page-header"},yn={class:"header-content"},kn={class:"header-top"},bn={class:"card-header"},wn={class:"card-body"},Tn={key:0,class:"tokens-section"},Cn={class:"section-header"},hn={class:"header-actions"},Sn={class:"tokens-grid"},$n={class:"token-display"},_n={class:"token-value"},Bn={class:"token-timestamps"},On={class:"timestamp-item"},Mn={class:"timestamp-value"},Un={class:"timestamp-item"},An={class:"timestamp-value"},En={class:"storage-info"},xn={class:"storage-item"},zn={key:0,class:"storage-upgrade"},Ln={class:"modal-actions"},Dn={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(e){const o=e,a=yt(),r=ft(),k=mt(),l=pt(),u=C(!1),v=C(!1),g=C(!1);C(null),C(null);const d=C(null),f=C(null),b=C("manual"),O=C(new Set),U=C(new Set),c=vt({name:"",token:"",server:"",wsUrl:""}),h={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},M=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],E=()=>{u.value=!0},B=async t=>{O.value.add(t.id);try{if(t.sourceUrl){let n;if(t.sourceUrl.startsWith(window.location.origin)||t.sourceUrl.startsWith("/")||t.sourceUrl.startsWith("http://localhost")||t.sourceUrl.startsWith("http://127.0.0.1"))n=await fetch(t.sourceUrl);else try{n=await fetch(t.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(G){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${G.message}`)}if(!n.ok)throw new Error(`请求失败: ${n.status} ${n.statusText}`);const S=await n.json();if(!S.token)throw new Error("返回数据中未找到token字段");l.updateToken(t.id,{token:S.token,server:S.server||t.server,lastRefreshed:Date.now()}),r.success("Token刷新成功")}else{k.info({title:"重新获取Token",content:`Token "${t.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{u.value=!0,b.value="manual",importForm.name=t.name,importForm.server=t.server,importForm.wsUrl=t.wsUrl},onNegativeClick:()=>{l.getWebSocketStatus(t.id)==="connected"&&l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl),r.info("正在尝试重新连接...")},500)}});return}l.getWebSocketStatus(t.id)==="connected"&&(l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl)},500))}catch(n){console.error("刷新Token失败:",n),r.error(n.message||"Token刷新失败")}finally{O.value.delete(t.id)}},K=t=>{k.warning({title:"升级为长期有效",content:`确认要将Token "${t.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{l.upgradeTokenToPermanent(t.id)?r.success(`Token "${t.name}" 已升级为长期有效！`):r.error("升级失败，该Token可能已经是长期有效状态")}})},H=(t,n=!1)=>{const w=We.value===t.id,S=L(t.id);if(w&&S==="connected"&&!n){r.info(`${t.name} 已选中且已连接`);return}if(w&&S==="connecting"&&!n){r.info(`${t.name} 正在连接中...`);return}l.selectToken(t.id,n)?n?r.success(`强制重连：${t.name}`):w?r.success(`重新连接：${t.name}`):r.success(`已选择：${t.name}`):r.error(`选择Token失败：${t.name}`)},L=t=>l.getWebSocketStatus(t),Z=t=>{const n=L(t);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[n]||"未连接"},Y=t=>{const n=L(t);return{connected:"success",connecting:"processing",disconnected:"normal",error:"danger",disconnecting:"warning"}[n]||"normal"},q=t=>{const n=[{label:"编辑",key:"edit",icon:()=>V(I,null,{default:()=>V(Gt)})},{label:"复制Token",key:"copy",icon:()=>V(I,null,{default:()=>V(qt)})}];return t.importMethod==="url"&&t.sourceUrl?n.push({label:"从URL刷新",key:"refresh-url",icon:()=>V(I,null,{default:()=>V(Vt)})}):n.push({label:"重新获取",key:"refresh",icon:()=>V(I,null,{default:()=>V(Ke)})}),n.push({type:"divider"},{label:"删除",key:"delete",icon:()=>V(I,null,{default:()=>V(Ht)}),props:{style:{color:"#e74c3c"}}}),n},R=async(t,n)=>{switch(t){case"edit":j(n);break;case"copy":X(n);break;case"refresh":B(n);break;case"refresh-url":B(n);break;case"delete":Q(n);break}},j=t=>{f.value=t,Object.assign(c,{name:t.name,token:t.token,server:t.server||"",wsUrl:t.wsUrl||""}),g.value=!0},J=async()=>{if(!(!d.value||!f.value))try{await d.value.validate(),l.updateToken(f.value.id,{name:c.name,token:c.token,server:c.server,wsUrl:c.wsUrl}),r.success("Token信息已更新"),g.value=!1,f.value=null}catch{}},X=async t=>{try{await navigator.clipboard.writeText(t.token),r.success("Token已复制到剪贴板")}catch{r.error("复制失败")}},Q=t=>{k.warning({title:"删除Token",content:`确定要删除Token "${t.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{l.removeToken(t.id),r.success("Token已删除")}})},ee=t=>{switch(t){case"export":te();break;case"import":ge();break;case"clean":ye();break;case"disconnect":ke();break;case"clear":be();break}},te=()=>{try{const t=l.exportTokens(),n=JSON.stringify(t,null,2),w=new Blob([n],{type:"application/json"}),S=document.createElement("a");S.href=URL.createObjectURL(w),S.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,S.click(),r.success("Token数据已导出")}catch{r.error("导出失败")}},ge=()=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=n=>{const w=n.target.files[0];if(w){const S=new FileReader;S.onload=G=>{try{const P=JSON.parse(G.target.result),x=l.importTokens(P);x.success?r.success(x.message):r.error(x.message)}catch{r.error("文件格式错误")}},S.readAsText(w)}},t.click()},ye=()=>{const t=l.cleanExpiredTokens();r.success(`已清理 ${t} 个过期Token`)},ke=()=>{l.gameTokens.forEach(t=>{l.closeWebSocketConnection(t.id)}),r.success("所有连接已断开")},be=()=>{k.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{l.clearAllTokens(),r.success("所有Token已清除")}})},ae=t=>{if(!t)return"";const n=t.length;return n<=8?t:t.substring(0,4)+"***"+t.substring(n-4)},ne=t=>new Date(t).toLocaleString("zh-CN"),we=()=>{a.push("/admin/dashboard")},Te=async t=>{U.value.add(t.id);try{if(l.selectToken(t.id),L(t.id)==="connected"){r.success(`${t.name} 已连接，进入任务管理`),a.push("/admin/dashboard");return}}finally{U.value.delete(t.id)}},re=async()=>{if(o.token||o.api)try{v.value=!0;let t=null;if(o.api){r.info("正在从API获取token...");const n=await fetch(o.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!n.ok)throw new Error(`API请求失败: ${n.status} ${n.statusText}`);const w=await n.json();if(!w.token)throw new Error("API返回数据中未找到token字段");t=l.importBase64Token(o.name||w.name||"通过API导入的Token",w.token,{server:o.server||w.server,wsUrl:o.wsUrl,sourceUrl:o.api,importMethod:"url"})}else o.token&&(r.info("正在导入token..."),t=l.importBase64Token(o.name||"通过URL导入的Token",o.token,{server:o.server,wsUrl:o.wsUrl,importMethod:"url"}));if(t&&t.success)r.success(`Token "${t.tokenName}" 导入成功！`),o.auto&&t.token?(l.selectToken(t.token.id),r.success("正在跳转到控制台..."),setTimeout(()=>{a.push("/admin/dashboard")},1500)):a.replace("/tokens");else throw new Error((t==null?void 0:t.message)||"Token导入失败")}catch(t){console.error("URL参数处理失败:",t),r.error(`导入失败: ${t.message}`),a.replace("/tokens")}finally{v.value=!1}};return Ee(()=>[o.token,o.api],re,{immediate:!1}),qe(async()=>{l.initTokenStore(),await re(),!l.hasTokens&&!o.token&&!o.api&&(u.value=!0)}),(t,n)=>{const w=rt,S=A("n-radio-button"),G=A("n-radio-group"),P=ze,x=A("n-button"),Pe=A("n-dropdown"),Qe=St,et=rn,tt=mn,Ie=Je,nt=A("n-tag"),ot=Rt,lt=Ct,ie=A("n-input"),ue=A("n-form-item"),st=A("n-form"),at=A("n-modal");return y(),N("div",pn,[p("div",vn,[p("div",gn,[p("div",yn,[p("div",kn,[n[15]||(n[15]=p("img",{src:kt,alt:"XYZW",class:"brand-logo"},null,-1)),s(w)]),n[16]||(n[16]=p("h1",null,"游戏Token管理",-1))])]),s(P,{class:"token-import-modal",visible:u.value,"onUpdate:visible":n[7]||(n[7]=m=>u.value=m),width:"40rem",footer:!1,"default-visible":!T(l).hasTokens},{title:i(()=>[p("h2",null,[s(T(I),null,{default:i(()=>[s(T(Ge))]),_:1}),n[17]||(n[17]=_(" 添加游戏Token ",-1))])]),default:i(()=>[p("div",bn,[s(G,{value:b.value,"onUpdate:value":n[0]||(n[0]=m=>b.value=m),class:"import-method-tabs",size:"small"},{default:i(()=>[s(S,{value:"manual"},{default:i(()=>[...n[18]||(n[18]=[_(" 手动输入 ",-1)])]),_:1}),s(S,{value:"url"},{default:i(()=>[...n[19]||(n[19]=[_(" URL获取 ",-1)])]),_:1}),s(S,{value:"bin"},{default:i(()=>[...n[20]||(n[20]=[_(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),p("div",wn,[b.value==="manual"?(y(),z(bt,{key:0,onCancel:n[1]||(n[1]=()=>u.value=!1),onOk:n[2]||(n[2]=()=>u.value=!1)})):$("",!0),b.value==="url"?(y(),z(wt,{key:1,onCancel:n[3]||(n[3]=()=>u.value=!1),onOk:n[4]||(n[4]=()=>u.value=!1)})):$("",!0),b.value==="bin"?(y(),z(ht,{key:2,onCancel:n[5]||(n[5]=()=>u.value=!1),onOk:n[6]||(n[6]=()=>u.value=!1)})):$("",!0)])]),_:1},8,["visible","default-visible"]),T(l).hasTokens?(y(),N("div",Tn,[p("div",Cn,[p("h2",null,"我的Token列表 ("+W(T(l).gameTokens.length)+"个)",1),p("div",hn,[T(l).selectedToken?(y(),z(x,{key:0,type:"success",onClick:we},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Ne))]),_:1})]),default:i(()=>[n[21]||(n[21]=_(" 返回控制台 ",-1))]),_:1})):$("",!0),u.value?$("",!0):(y(),z(x,{key:1,type:"primary",onClick:n[8]||(n[8]=m=>u.value=!0)},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Ge))]),_:1})]),default:i(()=>[n[22]||(n[22]=_(" 添加Token ",-1))]),_:1})),s(Pe,{options:M,onSelect:ee},{default:i(()=>[s(x,null,{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Kt))]),_:1})]),default:i(()=>[n[23]||(n[23]=_(" 批量操作 ",-1))]),_:1})]),_:1})])]),p("div",Sn,[(y(!0),N(Xe,null,gt(T(l).gameTokens,m=>(y(),z(ot,{key:m.id,class:F({"token-card":!0,active:T(We)===m.id}),onClick:oe=>H(m)},{title:i(()=>[s(tt,{class:"token-name"},{default:i(()=>[_(W(m.name)+" ",1),m.server?(y(),z(Qe,{key:0,color:"red"},{default:i(()=>[_(W(m.server),1)]),_:2},1024)):$("",!0),s(et,{status:Y(m.id),text:Z(m.id)},null,8,["status","text"])]),_:2},1024)]),extra:i(()=>[s(Pe,{options:q(m),onSelect:oe=>R(oe,m)},{default:i(()=>[s(x,{text:""},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Yt))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:i(()=>[p("div",$n,[n[24]||(n[24]=p("span",{class:"token-label"},"Token:",-1)),p("code",_n,W(ae(m.token)),1)]),s(Ie,{loading:O.value.has(m.id),onClick:me(oe=>B(m),["stop"])},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Ke))]),_:1})]),default:i(()=>[_(" "+W(m.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),p("div",Bn,[p("div",On,[n[25]||(n[25]=p("span",{class:"timestamp-label"},"创建：",-1)),p("span",Mn,W(ne(m.createdAt)),1)]),p("div",Un,[n[26]||(n[26]=p("span",{class:"timestamp-label"},"使用：",-1)),p("span",An,W(ne(m.lastUsed)),1)])]),p("div",En,[p("div",xn,[n[27]||(n[27]=p("span",{class:"storage-label"},"存储类型：",-1)),s(nt,{size:"small",type:m.importMethod==="url"?"success":"warning"},{default:i(()=>[_(W(m.importMethod==="url"?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),m.importMethod!=="url"?(y(),N("div",zn,[s(x,{size:"tiny",type:"success",ghost:"",onClick:me(oe=>K(m),["stop"])},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Qt))]),_:1})]),default:i(()=>[n[28]||(n[28]=_(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])])):$("",!0)])]),actions:i(()=>[s(x,{type:"primary",size:"large",block:"",loading:U.value.has(m.id),onClick:oe=>Te(m)},{icon:i(()=>[s(T(I),null,{default:i(()=>[s(T(Ne))]),_:1})]),default:i(()=>[n[29]||(n[29]=_(" 开始任务管理 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["class","onClick"]))),128))])])):$("",!0),!T(l).hasTokens&&!u.value?(y(),z(lt,{key:1},{image:i(()=>[...n[30]||(n[30]=[p("i",{class:"mdi:bed-empty"},null,-1)])]),default:i(()=>[n[32]||(n[32]=_(" 还没有导入任何Token ",-1)),s(Ie,{type:"link",onClick:E},{default:i(()=>[...n[31]||(n[31]=[_("打开Token管理",-1)])]),_:1})]),_:1})):$("",!0)]),s(at,{show:g.value,"onUpdate:show":n[14]||(n[14]=m=>g.value=m),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:i(()=>[p("div",Ln,[s(x,{onClick:n[13]||(n[13]=m=>g.value=!1)},{default:i(()=>[...n[33]||(n[33]=[_(" 取消 ",-1)])]),_:1}),s(x,{type:"primary",onClick:J},{default:i(()=>[...n[34]||(n[34]=[_(" 保存 ",-1)])]),_:1})])]),default:i(()=>[s(st,{ref_key:"editFormRef",ref:d,model:c,rules:h,"label-placement":"left","label-width":"80px"},{default:i(()=>[s(ue,{label:"名称",path:"name"},{default:i(()=>[s(ie,{value:c.name,"onUpdate:value":n[9]||(n[9]=m=>c.name=m)},null,8,["value"])]),_:1}),s(ue,{label:"Token字符串",path:"token"},{default:i(()=>[s(ie,{value:c.token,"onUpdate:value":n[10]||(n[10]=m=>c.token=m),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),s(ue,{label:"服务器"},{default:i(()=>[s(ie,{value:c.server,"onUpdate:value":n[11]||(n[11]=m=>c.server=m)},null,8,["value"])]),_:1}),s(ue,{label:"WebSocket地址"},{default:i(()=>[s(ie,{value:c.wsUrl,"onUpdate:value":n[12]||(n[12]=m=>c.wsUrl=m)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},to=$t(Dn,[["__scopeId","data-v-71b2ffc0"]]);export{to as default};
